
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Word Kingdom - å•è¯ç‹å›½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background-color: #1e1b4b; margin: 0; overflow: hidden; user-select: none; color: white; }
        #loading-overlay { position: fixed; inset: 0; background: #1e1b4b; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s; }
        .loader-castle { font-size: 80px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .progress-container { width: 280px; height: 12px; background: #312e81; border: 2px solid #4f46e5; border-radius: 20px; margin-top: 20px; overflow: hidden; position: relative; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #4f46e5, #818cf8); transition: width 0.3s; }
        .pixel-border { border: 4px solid black; box-shadow: 6px 6px 0px rgba(0,0,0,0.3); }
        .pixel-button { background: #4f46e5; color: white; border: 4px solid black; padding: 12px 24px; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: all 0.1s; box-shadow: 4px 4px 0px black; position: relative; }
        .pixel-button:hover { background: #6366f1; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px black; }
        .pixel-button:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px black; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .floating { animation: float 3s ease-in-out infinite; }
        .fireball { position: absolute; width: 40px; height: 40px; background: orange; border-radius: 50%; box-shadow: 0 0 20px #f97316; z-index: 50; transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s; pointer-events: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-overlay">
        <div class="loader-castle">ğŸ°</div>
        <div class="text-xl font-bold mt-4 uppercase tracking-tighter">æ­£åœ¨ç‚¹äº®ç‹å›½æ˜Ÿç«...</div>
        <div class="progress-container"><div id="progress-bar"></div></div>
        <div id="loading-status" class="mt-2 text-xs text-indigo-400 font-mono">æ­£åœ¨è§£æé­”æ³•å·è½´...</div>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        /** ================= DATA (200+ WORDS) ================= **/
        const RAW_WORDS = {
            1: [
                { id: 'u1-1', english: 'ancient', chinese: 'å¤ä»£çš„', pos: 'adj', example: 'This is an ancient building.' },
                { id: 'u1-2', english: 'camp', chinese: 'è¥åœ°', pos: 'n', example: 'We stay at the camp.' },
                { id: 'u1-3', english: 'landscape', chinese: 'é£æ™¯', pos: 'n', example: 'The landscape is beautiful.' },
                { id: 'u1-4', english: 'strange', chinese: 'å¥‡æ€ªçš„', pos: 'adj', example: 'That is a strange bird.' },
                { id: 'u1-5', english: 'vacation', chinese: 'å‡æœŸ', pos: 'n', example: 'I like my summer vacation.' },
                { id: 'u1-6', english: 'fantastic', chinese: 'æå¥½çš„', pos: 'adj', example: 'We had a fantastic time.' },
                { id: 'u1-7', english: 'town', chinese: 'åŸé•‡', pos: 'n', example: 'My town is very small.' },
                { id: 'u1-8', english: 'comfortable', chinese: 'èˆ’é€‚çš„', pos: 'adj', example: 'This sofa is comfortable.' }
            ],
            2: [
                { id: 'u2-1', english: 'kitchen', chinese: 'å¨æˆ¿', pos: 'n', example: 'Mom is in the kitchen.' },
                { id: 'u2-2', english: 'furniture', chinese: 'å®¶å…·', pos: 'n', example: 'We bought new furniture.' },
                { id: 'u2-3', english: 'fridge', chinese: 'å†°ç®±', pos: 'n', example: 'Milk is in the fridge.' },
                { id: 'u2-4', english: 'bathroom', chinese: 'æµ´å®¤', pos: 'n', example: 'The bathroom is clean.' },
                { id: 'u2-5', english: 'mirror', chinese: 'é•œå­', pos: 'n', example: 'Look in the mirror.' },
                { id: 'u2-6', english: 'garden', chinese: 'èŠ±å›­', pos: 'n', example: 'Flowers in the garden.' },
                { id: 'u2-7', english: 'neighbor', chinese: 'é‚»å±…', pos: 'n', example: 'He is my neighbor.' },
                { id: 'u2-8', english: 'decorate', chinese: 'è£…é¥°', pos: 'v', example: 'Decorate the tree.' }
            ],
            3: [
                { id: 'u3-1', english: 'subject', chinese: 'ç§‘ç›®', pos: 'n', example: 'Math is my favorite subject.' },
                { id: 'u3-2', english: 'science', chinese: 'ç§‘å­¦', pos: 'n', example: 'We learn science.' },
                { id: 'u3-3', english: 'project', chinese: 'é¡¹ç›®', pos: 'n', example: 'We finished the project.' },
                { id: 'u3-4', english: 'grade', chinese: 'æˆç»©', pos: 'n', example: 'She got a high grade.' }
            ],
            // æ›´å¤š Unit æ•°æ®çœç•¥ï¼Œæ­¤å¤„ä»…ä¸ºç¤ºä¾‹ï¼Œæ­£å¼ç‰ˆåº”åŒ…å« Unit 1-8 çº¦ 200+ è¯æ±‡
        };

        const WORLDS = [
            { id: 1, name: "Ancient Valley (Unit 1)", color: "#10b981" },
            { id: 2, name: "Cozy Home (Unit 2)", color: "#f59e0b" },
            { id: 3, name: "Social Plaza (Unit 3)", color: "#3b82f6" },
            { id: 4, name: "Adventure Peak (Unit 4)", color: "#8b5cf6" },
            { id: 5, name: "Health Canyon (Unit 5)", color: "#6366f1" },
            { id: 6, name: "Future City (Unit 6)", color: "#06b6d4" },
            { id: 7, name: "Gourmet Island (Unit 7)", color: "#f43f5e" },
            { id: 8, name: "Wisdom Temple (Unit 8)", color: "#f97316" }
        ];

        const HEROES = [
            { id: 'h1', name: 'Princess Sky', color: '#fbc02d', desc: 'çµåŠ¨å¦‚é£ï¼ŒæŒæ¡è¯æ³•ç§˜å¢ƒã€‚', sprite: 'alice' },
            { id: 'h2', name: 'Prince Valiant', color: '#e53935', desc: 'å‹‡æ•¢å®ˆæŠ¤ï¼Œå‡»ç¢ä¸€åˆ‡éšœç¢ã€‚', sprite: 'prince' },
            { id: 'h3', name: 'Red Hood', color: '#c62828', desc: 'ç©¿æ¢­æ—é—´ï¼Œå¯»æ‰¾çœŸç†ã€‚', sprite: 'red' },
            { id: 'h4', name: 'Earth Ivy', color: '#81c784', desc: 'åšç§¯è–„å‘ï¼Œæ·±æ‰æ ¹åŸºã€‚', sprite: 'ivy' }
        ];

        /** ================= COMPONENTS ================= **/

        const PixelSprite = ({ type, variant, color, action }) => {
            const isHit = action === 'hit';
            const isAttack = action === 'attack';
            
            return (
                <div className={`relative w-24 h-24 flex items-end justify-center transition-all ${isAttack ? 'translate-x-4' : ''} ${isHit ? 'animate-bounce' : 'animate-pulse'}`}>
                    <svg width="100%" height="100%" viewBox="0 0 100 120">
                        {/* åŠ¨æ€è§’è‰²æ¸²æŸ“ (æ ¹æ® variant é€‰æ‹© SVG ç»“æ„) */}
                        <g style={{ filter: isHit ? 'grayscale(1) brightness(2)' : 'none' }}>
                            <circle cx="50" cy="40" r="30" fill="#ffe0b2" stroke="black" strokeWidth="4" />
                            <rect x="25" y="70" width="50" height="40" fill={color} stroke="black" strokeWidth="4" />
                            <circle cx="40" cy="40" r="4" fill="black" />
                            <circle cx="60" cy="40" r="4" fill="black" />
                            {variant === 'alice' && <path d="M20,30 Q10,70 30,100" fill="none" stroke="#fbc02d" strokeWidth="8" />}
                        </g>
                    </svg>
                    {isHit && <div className="absolute top-0 text-red-500 font-black text-2xl">-10</div>}
                </div>
            );
        };

        const BattleArea = ({ hero, monsterColor, heroAction, monsterAction, showFireball }) => (
            <div className="w-full h-52 pixel-border bg-sky-200 rounded-[30px] flex items-end justify-between px-12 pb-6 relative overflow-hidden mb-6">
                <div className="absolute inset-0 bg-gradient-to-b from-sky-400 to-green-300 opacity-60"></div>
                <PixelSprite type="hero" variant={hero.sprite} color={hero.color} action={heroAction} />
                
                {/* ç«çƒåŠ¨ç”» */}
                {showFireball && (
                    <div className="fireball" style={{ left: '100px', bottom: '60px', transform: 'translateX(300px)' }}>ğŸ”¥</div>
                )}

                <PixelSprite type="monster" variant="blob" color={monsterColor} action={monsterAction} />
            </div>
        );

        /** ================= GAME STAGES ================= **/

        const StageOne = ({ words, hero, onComplete }) => {
            const [idx, setIdx] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [showHint, setShowHint] = useState(false);
            const word = words[idx];

            const options = useMemo(() => {
                const choices = [word.chinese, "é”™è¯¯é¡¹A", "é”™è¯¯é¡¹B", "é”™è¯¯é¡¹C"];
                return choices.sort(() => Math.random() - 0.5);
            }, [idx]);

            const handleAnswer = (ans) => {
                if (ans === word.chinese) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        if (idx + 1 < words.length) setIdx(idx + 1);
                        else onComplete();
                    }, 800);
                } else {
                    setFeedback('wrong');
                    setShowHint(true);
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="h-full flex flex-col p-4">
                    <BattleArea hero={hero} monsterColor="#475569" heroAction={feedback==='correct'?'attack':'idle'} monsterAction={feedback==='wrong'?'attack':(feedback==='correct'?'hit':'idle')} showFireball={feedback==='correct'} />
                    <div className="flex-1 flex flex-col items-center justify-center gap-6">
                        <div className="text-6xl font-black uppercase text-indigo-900 tracking-tighter">{word.english}</div>
                        <div className="grid grid-cols-2 gap-4 w-full max-w-xl">
                            {options.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt)} className="pixel-button text-xl h-20">{opt}</button>
                            ))}
                        </div>
                        {showHint && (
                            <div className="mt-4 p-4 bg-yellow-100 border-4 border-black text-indigo-900 font-bold animate-bounce">
                                ğŸ’¡ æç¤ºï¼š{word.english} çš„æ„æ€æ˜¯ "{word.chinese}"
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const StageTwo = ({ words, hero, onComplete }) => {
            const [idx, setIdx] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const word = words[idx];
            
            const display = useMemo(() => {
                const arr = word.english.split('');
                const blankIdx = Math.floor(arr.length / 2);
                const char = arr[blankIdx];
                arr[blankIdx] = '_';
                return { text: arr.join(''), missing: char };
            }, [idx]);

            const handleKey = (l) => {
                if(l === display.missing) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        if(idx + 1 < words.length) setIdx(idx + 1);
                        else onComplete();
                    }, 800);
                } else {
                    setFeedback('wrong');
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="h-full flex flex-col p-4">
                    <BattleArea hero={hero} monsterColor="#059669" heroAction={feedback==='correct'?'attack':'idle'} monsterAction={feedback==='wrong'?'attack':(feedback==='correct'?'hit':'idle')} showFireball={feedback==='correct'} />
                    <div className="flex-1 flex flex-col items-center justify-center gap-8">
                        <div className="text-4xl font-black text-indigo-900">{word.chinese}</div>
                        <div className="text-8xl font-black text-indigo-900 tracking-widest">{display.text.toUpperCase()}</div>
                        <div className="flex flex-wrap justify-center gap-2 max-w-xl">
                            {"abcdefghijklmnopqrstuvwxyz".split('').map(l => (
                                <button key={l} onClick={() => handleKey(l)} className="w-10 h-10 pixel-border bg-white text-black font-bold hover:bg-indigo-100 uppercase">{l}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        /** ================= MAIN APP ================= **/
        const App = () => {
            const [state, setState] = useState('LOGIN');
            const [user, setUser] = useState({ id: 'å‹‡è€…', unlocked: [1] });
            const [hero, setHero] = useState(null);
            const [world, setWorld] = useState(null);
            const [stage, setStage] = useState(1);

            if (state === 'LOGIN') return (
                <div className="h-screen flex flex-col items-center justify-center bg-indigo-900 p-8">
                    <div className="bg-white p-12 pixel-border flex flex-col gap-8 max-w-sm w-full">
                        <h1 className="text-4xl font-black text-center text-indigo-900 uppercase tracking-tighter">Word Kingdom</h1>
                        <input id="uname" className="border-4 border-black p-4 text-xl font-bold text-indigo-900 outline-none" placeholder="è¾“å…¥ ID" defaultValue="Player1" />
                        <button onClick={() => { setUser({...user, id: document.getElementById('uname').value}); setState('HERO'); }} className="pixel-button bg-yellow-400 text-indigo-900 text-2xl font-black">å¼€å§‹å†’é™©</button>
                    </div>
                </div>
            );

            if (state === 'HERO') return (
                <div className="h-screen bg-indigo-950 p-8 flex flex-col items-center justify-center">
                    <h2 className="text-3xl font-black mb-12">é€‰æ‹©ä½ çš„å®ˆæŠ¤è€…</h2>
                    <div className="flex gap-6 overflow-x-auto w-full max-w-5xl px-4 pb-8">
                        {HEROES.map(h => (
                            <div key={h.id} onClick={() => { setHero(h); setState('MAP'); }} className="min-w-[240px] bg-white p-8 pixel-border text-indigo-900 cursor-pointer hover:bg-yellow-50 hover:-translate-y-2 transition-all flex flex-col items-center">
                                <PixelSprite variant={h.sprite} color={h.color} action="idle" />
                                <div className="mt-6 font-black text-2xl">{h.name}</div>
                                <div className="mt-4 text-sm text-center font-medium opacity-70">{h.desc}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (state === 'MAP') return (
                <div className="h-screen bg-sky-100 p-8 overflow-y-auto">
                    <div className="max-w-4xl mx-auto flex flex-col gap-10">
                        <h1 className="text-4xl font-black text-indigo-900 text-center uppercase tracking-widest">Adventure Map</h1>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            {WORLDS.map(w => (
                                <div key={w.id} className="bg-white p-8 pixel-border group relative overflow-hidden">
                                    <div className="text-2xl font-black mb-6 text-indigo-900">{w.name}</div>
                                    <div className="flex gap-4">
                                        {[1, 2, 3].map(s => (
                                            <button key={s} onClick={() => { setWorld(w); setStage(1); setState('GAME'); }} className="w-14 h-14 bg-white border-4 border-black font-black text-xl hover:bg-indigo-600 hover:text-white flex items-center justify-center shadow-[4px_4px_0_black]">
                                                {s}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (state === 'GAME') {
                const words = RAW_WORDS[world.id] || RAW_WORDS[1];
                return (
                    <div className="h-screen bg-sky-50 flex flex-col">
                        <div className="h-16 flex justify-between items-center px-8 border-b-4 border-black bg-white">
                            <button onClick={() => setState('MAP')} className="text-red-500 font-black">é€€å‡º</button>
                            <div className="font-black text-indigo-900 uppercase">é˜¶æ®µ {stage}/3</div>
                        </div>
                        <div className="flex-1">
                            {stage === 1 && <StageOne words={words} hero={hero} onComplete={() => setStage(2)} />}
                            {stage === 2 && <StageTwo words={words} hero={hero} onComplete={() => setStage(3)} />}
                            {stage === 3 && (
                                <div className="h-full flex flex-col items-center justify-center gap-10">
                                    <div className="text-4xl font-black text-indigo-900">é­”æ³•å¤§ç»“å±€</div>
                                    <div className="text-2xl font-medium max-w-md text-center">æœ€åä¸€å…³ï¼šè¿ç”¨å•è¯çš„åŠ›é‡ï¼Œæ‘§æ¯æœ€ç»ˆå ¡å’ï¼</div>
                                    <button onClick={() => setState('WIN')} className="pixel-button bg-yellow-400 text-indigo-900 px-12 py-6 text-2xl">å‘èµ·æœ€ç»ˆæ”»å‡»</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (state === 'WIN') return (
                <div className="h-screen flex flex-col items-center justify-center bg-emerald-600 text-white p-8">
                    <div className="text-9xl floating mb-8">ğŸ†</div>
                    <h2 className="text-6xl font-black mb-4 uppercase">å†’é™©å¤§è·å…¨èƒœï¼</h2>
                    <p className="text-2xl font-bold opacity-80 mb-12">ä½ å·²æˆä¸ºå•è¯ç‹å›½çš„ä¼ å¥‡ã€‚</p>
                    <button onClick={() => setState('MAP')} className="pixel-button bg-yellow-400 text-indigo-900 px-12 py-6 text-2xl">å›åˆ°åœ°å›¾</button>
                </div>
            );

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        window.dispatchEvent(new Event('game-ready'));
    </script>

    <script>
        // åŠ è½½é€»è¾‘
        const progressBar = document.getElementById('progress-bar');
        let p = 0;
        const itv = setInterval(() => {
            if(p < 98) { p += Math.random()*10; progressBar.style.width = p + '%'; }
        }, 150);
        window.addEventListener('game-ready', () => {
            clearInterval(itv);
            progressBar.style.width = '100%';
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').remove(), 500);
            }, 500);
        });
    </script>
</body>
</html>
