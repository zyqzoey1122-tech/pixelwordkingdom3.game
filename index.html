
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Word Kingdom - å•è¯ç‹å›½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel å®æ—¶ç¼–è¯‘å™¨ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- ç¨³å®šçš„ UMD ç‰ˆæœ¬ React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background-color: #1e1b4b; margin: 0; overflow: hidden; user-select: none; color: white; }
        #loading-overlay { position: fixed; inset: 0; background: #1e1b4b; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s; }
        .loader-castle { font-size: 80px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .progress-container { width: 280px; height: 12px; background: #312e81; border: 2px solid #4f46e5; border-radius: 20px; margin-top: 20px; overflow: hidden; position: relative; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #4f46e5, #818cf8); transition: width 0.3s; }
        #loading-status { font-size: 12px; color: #818cf8; margin-top: 10px; font-family: monospace; }
        #error-console { display: none; position: absolute; bottom: 20px; left: 20px; right: 20px; background: #7f1d1d; border: 2px solid #ef4444; padding: 15px; border-radius: 8px; color: #fecaca; font-family: monospace; font-size: 11px; }
        .pixel-border { border: 4px solid black; box-shadow: 6px 6px 0px rgba(0,0,0,0.3); }
        .pixel-button { background: #4f46e5; color: white; border: 4px solid black; padding: 12px 24px; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: all 0.1s; box-shadow: 4px 4px 0px black; }
        .pixel-button:hover { background: #6366f1; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px black; }
        .pixel-button:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px black; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-overlay">
        <div class="loader-castle">ğŸ°</div>
        <div class="text-xl font-bold mt-4 uppercase tracking-tighter">æ­£åœ¨è§£å¼€é­”æ³•å·è½´...</div>
        <div class="progress-container"><div id="progress-bar"></div></div>
        <div id="loading-status">æ­£åœ¨å¼•å¯¼ä»¥å¤ªèƒ½é‡...</div>
        <div id="error-console">
            <div class="font-bold border-b border-red-400 mb-2 pb-1">âš ï¸ æ—¶ç©ºå¹²æ¶‰ (è„šæœ¬é”™è¯¯)ï¼š</div>
            <pre id="error-text" style="white-space: pre-wrap; font-size: 10px;"></pre>
        </div>
    </div>
    <div id="root"></div>

    <!-- é€»è¾‘å…¨åˆå¹¶è„šæœ¬ -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        /** æ•°æ®å¸¸é‡ */
        const WORLDS = [
            { id: 1, name: "Ancient Valley (Unit 1)", theme: "emerald", words: [
                { id: 'u1-1', english: 'ancient', chinese: 'å¤ä»£çš„', pos: 'adj' },
                { id: 'u1-2', english: 'camp', chinese: 'è¥åœ°', pos: 'n' },
                { id: 'u1-3', english: 'landscape', chinese: 'é£æ™¯', pos: 'n' },
                { id: 'u1-4', english: 'strange', chinese: 'å¥‡æ€ªçš„', pos: 'adj' },
                { id: 'u1-5', english: 'vacation', chinese: 'å‡æœŸ', pos: 'n' },
                { id: 'u1-6', english: 'fantastic', chinese: 'æå¥½çš„', pos: 'adj' },
                { id: 'u1-7', english: 'town', chinese: 'åŸé•‡', pos: 'n' },
                { id: 'u1-8', english: 'comfortable', chinese: 'èˆ’é€‚çš„', pos: 'adj' }
            ]},
            { id: 2, name: "Cozy Home (Unit 2)", theme: "amber", words: [
                { id: 'u2-1', english: 'kitchen', chinese: 'å¨æˆ¿', pos: 'n' },
                { id: 'u2-2', english: 'furniture', chinese: 'å®¶å…·', pos: 'n' }
            ]}
        ];

        const HEROES = [
            { id: 'h1', name: 'Princess Sky', color: '#10b981', description: 'çµåŠ¨å¦‚é£ï¼ŒæŒæ¡è¯æ±‡ç§˜å¢ƒã€‚' },
            { id: 'h2', name: 'Prince Valiant', color: '#ef4444', description: 'å‹‡æ•¢å®ˆæŠ¤è€…ï¼Œå‡»ç¢ä¸€åˆ‡éšœç¢ã€‚' }
        ];

        /** åŸºç¡€ç»„ä»¶ï¼šç²¾çµ */
        const PixelSprite = ({ type, color, action = 'idle' }) => (
            <div className={`relative w-24 h-24 flex items-end justify-center transition-all ${action === 'hit' ? 'animate-bounce' : 'animate-pulse'}`}>
                <svg width="100%" height="100%" viewBox="0 0 100 100">
                    <rect x="25" y="40" width="50" height="50" fill={color} stroke="black" strokeWidth="4" />
                    <rect x="35" y="55" width="8" height="8" fill="black" />
                    <rect x="57" y="55" width="8" height="8" fill="black" />
                </svg>
            </div>
        );

        /** å…³å¡è§†å›¾ */
        const GameView = ({ words, hero, onComplete, onQuit }) => {
            const [idx, setIdx] = useState(0);
            const word = words[idx];

            const handleAnswer = (isCorrect) => {
                if(isCorrect) {
                    if(idx + 1 < words.length) setIdx(idx + 1);
                    else onComplete();
                } else {
                    alert("å†æƒ³æƒ³ï¼Ÿ");
                }
            };

            const options = useMemo(() => {
                const choices = [word.chinese, "é”™è¯¯ç­”æ¡ˆA", "é”™è¯¯ç­”æ¡ˆB", "é”™è¯¯ç­”æ¡ˆC"];
                return choices.sort(() => Math.random() - 0.5);
            }, [idx]);

            return (
                <div className="flex flex-col h-full">
                    <div className="flex justify-between items-center p-4 bg-white/10">
                        <button onClick={onQuit} className="font-bold text-red-400">é€€å‡º</button>
                        <div className="font-bold">è¿›åº¦: {idx+1}/{words.length}</div>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-around p-8">
                        <div className="flex justify-between w-full max-w-lg">
                            <PixelSprite type="hero" color={hero.color} />
                            <PixelSprite type="monster" color="#475569" />
                        </div>
                        <div className="text-6xl font-black uppercase tracking-tighter">{word.english}</div>
                        <div className="grid grid-cols-2 gap-4 w-full max-w-xl">
                            {options.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt === word.chinese)} className="pixel-button text-xl">
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        /** ä¸»åº”ç”¨ */
        const App = () => {
            const [state, setState] = useState('LOGIN');
            const [hero, setHero] = useState(null);
            const [levelData, setLevelData] = useState([]);

            if (state === 'LOGIN') return (
                <div className="h-screen flex flex-col items-center justify-center p-8 bg-indigo-900">
                    <div className="bg-white p-12 pixel-border flex flex-col gap-6 text-indigo-900">
                        <h1 className="text-4xl font-black text-center uppercase">Word Kingdom</h1>
                        <input className="border-4 border-black p-4 text-xl outline-none" placeholder="è¾“å…¥ä½ çš„ ID" />
                        <button onClick={() => setState('HERO')} className="pixel-button bg-yellow-400 text-indigo-900">å¼€å§‹å†’é™©</button>
                    </div>
                </div>
            );

            if (state === 'HERO') return (
                <div className="h-screen flex flex-col items-center justify-center p-8 bg-indigo-950">
                    <h2 className="text-3xl font-black mb-12">é€‰æ‹©ä½ çš„è‹±é›„</h2>
                    <div className="flex gap-8">
                        {HEROES.map(h => (
                            <div key={h.id} onClick={() => { setHero(h); setState('MAP'); }} className="bg-white p-8 pixel-border text-indigo-900 cursor-pointer hover:bg-yellow-50">
                                <PixelSprite color={h.color} />
                                <div className="mt-4 font-black text-center">{h.name}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (state === 'MAP') return (
                <div className="h-screen overflow-y-auto p-8 bg-sky-100 text-indigo-900">
                    <h1 className="text-3xl font-black mb-8 text-center">å†’é™©åœ°å›¾</h1>
                    <div className="max-w-xl mx-auto flex flex-col gap-6">
                        {WORLDS.map(w => (
                            <div key={w.id} className="bg-white p-6 pixel-border">
                                <div className="font-black text-xl mb-4">{w.name}</div>
                                <div className="flex gap-4">
                                    <button onClick={() => { setLevelData(w.words); setState('GAME'); }} className="w-12 h-12 bg-indigo-600 text-white font-bold pixel-border">1</button>
                                    <div className="w-12 h-12 bg-gray-200 pixel-border flex items-center justify-center opacity-50">ğŸ”’</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (state === 'GAME') return (
                <div className="h-screen bg-indigo-800">
                    <GameView words={levelData} hero={hero} onComplete={() => setState('MAP')} onQuit={() => setState('MAP')} />
                </div>
            );

            return null;
        };

        // æ¸²æŸ“å¹¶é€šçŸ¥è¿›åº¦æ¡ç»“æŸ
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        window.dispatchEvent(new Event('game-ready'));
    </script>

    <script>
        // è¿›åº¦æ¡æ§åˆ¶é€»è¾‘
        const progressBar = document.getElementById('progress-bar');
        const errorConsole = document.getElementById('error-console');
        const errorText = document.getElementById('error-text');
        let progress = 0;

        const interval = setInterval(() => {
            if (progress < 95) {
                progress += Math.random() * 5;
                progressBar.style.width = progress + '%';
            }
        }, 200);

        window.addEventListener('game-ready', () => {
            clearInterval(interval);
            progressBar.style.width = '100%';
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').remove(), 500);
            }, 500);
        });

        window.onerror = (msg, src, line) => {
            errorConsole.style.display = 'block';
            errorText.innerText += `\n[é”™è¯¯] ${msg}\nä½ç½®: ${line}è¡Œ`;
        };
    </script>
</body>
</html>
