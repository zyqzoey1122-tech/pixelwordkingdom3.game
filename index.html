
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Word Kingdom - Master Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap');
        body { font-family: 'Quicksand', sans-serif; background-color: #0f172a; margin: 0; overflow: hidden; user-select: none; color: white; }
        
        /* Pixel Styling */
        .pixel-border { border: 4px solid black; box-shadow: 6px 6px 0px rgba(0,0,0,0.4); }
        .pixel-button { 
            background: #4f46e5; color: white; border: 4px solid black; 
            padding: 12px 24px; font-weight: 900; text-transform: uppercase; 
            cursor: pointer; transition: all 0.1s; box-shadow: 4px 4px 0px black; 
            position: relative; 
        }
        .pixel-button:hover { background: #6366f1; transform: translate(-2px, -2px); box-shadow: 6px 6px 0px black; }
        .pixel-button:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px black; }
        .pixel-button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Combat Animations */
        @keyframes fireball-fly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            90% { transform: translate(400px, -20px) scale(1.5); opacity: 1; }
            100% { transform: translate(450px, -25px) scale(0); opacity: 0; }
        }
        .fireball-active { animation: fireball-fly 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .shake-effect { animation: shake 0.2s ease-in-out 3; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .floating { animation: float 3s ease-in-out infinite; }

        /* Loading Overlay */
        #loading-overlay { position: fixed; inset: 0; background: #1e1b4b; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s; }
        .progress-container { width: 300px; height: 12px; background: #312e81; border: 3px solid #4f46e5; border-radius: 20px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #4f46e5, #818cf8); transition: width 0.3s; }
        
        /* Grid Layout Fixes */
        .game-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; width: 100%; max-width: 600px; }
        .keyboard-grid { display: grid; grid-template-columns: repeat(13, 1fr); gap: 4px; width: 100%; max-width: 500px; }

        /* Scrollbar Hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-overlay">
        <div class="text-8xl mb-6">ğŸ°</div>
        <div class="text-2xl font-black mb-4 tracking-widest text-indigo-300">PIXEL WORD KINGDOM</div>
        <div class="progress-container"><div id="progress-bar"></div></div>
        <div class="mt-2 text-xs text-indigo-400 font-mono tracking-widest">LOADING MAGIC SCROLLS...</div>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        /** ================= FULL VOCABULARY (UNITS 1-8) ================= **/
        const RAW_WORDS = {
            1: [
                { english: 'ancient', chinese: 'å¤ä»£çš„', pos: 'adj', example: 'This is an ancient building.' },
                { english: 'landscape', chinese: 'é£æ™¯', pos: 'n', example: 'The landscape is beautiful.' },
                { english: 'fantastic', chinese: 'æå¥½çš„', pos: 'adj', example: 'We had a fantastic time.' },
                { english: 'comfortable', chinese: 'èˆ’é€‚çš„', pos: 'adj', example: 'This sofa is comfortable.' },
                { english: 'vacation', chinese: 'å‡æœŸ', pos: 'n', example: 'I like my summer vacation.' },
                { english: 'strange', chinese: 'å¥‡æ€ªçš„', pos: 'adj', example: 'That is a strange bird.' },
                { english: 'town', chinese: 'åŸé•‡', pos: 'n', example: 'My town is very small.' },
                { english: 'scenery', chinese: 'æ™¯è‰²', pos: 'n', example: 'I love mountain scenery.' }
            ],
            2: [
                { english: 'bathroom', chinese: 'æµ´å®¤', pos: 'n', example: 'The bathroom is clean.' },
                { english: 'kitchen', chinese: 'å¨æˆ¿', pos: 'n', example: 'Mom is in the kitchen.' },
                { english: 'furniture', chinese: 'å®¶å…·', pos: 'n', example: 'We bought new furniture.' },
                { english: 'fridge', chinese: 'å†°ç®±', pos: 'n', example: 'Milk is in the fridge.' },
                { english: 'mirror', chinese: 'é•œå­', pos: 'n', example: 'Look in the mirror.' },
                { english: 'garden', chinese: 'èŠ±å›­', pos: 'n', example: 'Flowers in the garden.' },
                { english: 'neighbor', chinese: 'é‚»å±…', pos: 'n', example: 'He is my neighbor.' },
                { english: 'bedroom', chinese: 'å§å®¤', pos: 'n', example: 'Go to your bedroom.' }
            ],
            3: [
                { english: 'subject', chinese: 'ç§‘ç›®', pos: 'n', example: 'Math is my favorite subject.' },
                { english: 'science', chinese: 'ç§‘å­¦', pos: 'n', example: 'We learn science.' },
                { english: 'project', chinese: 'é¡¹ç›®', pos: 'n', example: 'We finished the project.' },
                { english: 'grade', chinese: 'æˆç»©', pos: 'n', example: 'She got a high grade.' },
                { english: 'library', chinese: 'å›¾ä¹¦é¦†', pos: 'n', example: 'I study in the library.' },
                { english: 'student', chinese: 'å­¦ç”Ÿ', pos: 'n', example: 'He is a good student.' },
                { english: 'teacher', chinese: 'è€å¸ˆ', pos: 'n', example: 'My teacher is kind.' },
                { english: 'classroom', chinese: 'æ•™å®¤', pos: 'n', example: 'Our classroom is bright.' }
            ],
            4: [
                { english: 'explore', chinese: 'æ¢ç´¢', pos: 'v', example: 'We will explore the forest.' },
                { english: 'journey', chinese: 'æ—…ç¨‹', pos: 'n', example: 'Our journey was long.' },
                { english: 'direction', chinese: 'æ–¹å‘', pos: 'n', example: 'Walk in the right direction.' },
                { english: 'map', chinese: 'åœ°å›¾', pos: 'n', example: 'I cannot read the map.' },
                { english: 'wild', chinese: 'é‡ç”Ÿçš„', pos: 'adj', example: 'Wild flowers are beautiful.' },
                { english: 'backpack', chinese: 'èƒŒåŒ…', pos: 'n', example: 'Put water into your backpack.' },
                { english: 'adventure', chinese: 'å†’é™©', pos: 'n', example: 'Life is an adventure.' },
                { english: 'danger', chinese: 'å±é™©', pos: 'n', example: 'We are in great danger.' }
            ],
            5: [
                { english: 'health', chinese: 'å¥åº·', pos: 'n', example: 'Health is very important.' },
                { english: 'exercise', chinese: 'è¿åŠ¨', pos: 'v', example: 'You should exercise daily.' },
                { english: 'doctor', chinese: 'åŒ»ç”Ÿ', pos: 'n', example: 'The doctor is very kind.' },
                { english: 'fresh', chinese: 'æ–°é²œçš„', pos: 'adj', example: 'The air is very fresh.' },
                { english: 'vegetable', chinese: 'è”¬èœ', pos: 'n', example: 'Eat green vegetables.' },
                { english: 'sleep', chinese: 'ç¡è§‰', pos: 'v', example: 'I sleep eight hours.' },
                { english: 'happy', chinese: 'å¿«ä¹çš„', pos: 'adj', example: 'I am happy to see you.' },
                { english: 'check', chinese: 'æ£€æŸ¥', pos: 'v', example: 'Check your work again.' }
            ],
            6: [
                { english: 'technology', chinese: 'æŠ€æœ¯', pos: 'n', example: 'Technology makes life easy.' },
                { english: 'internet', chinese: 'äº’è”ç½‘', pos: 'n', example: 'We use the internet.' },
                { english: 'computer', chinese: 'ç”µè„‘', pos: 'n', example: 'I have a new computer.' },
                { english: 'robot', chinese: 'æœºå™¨äºº', pos: 'n', example: 'The robot can help us.' },
                { english: 'future', chinese: 'æœªæ¥', pos: 'n', example: 'Who knows the future?' },
                { english: 'power', chinese: 'åŠ›é‡', pos: 'n', example: 'Knowledge is power.' },
                { english: 'charge', chinese: 'å……ç”µ', pos: 'v', example: 'I must charge my phone.' },
                { english: 'smart', chinese: 'èªæ˜çš„', pos: 'adj', example: 'He is a smart boy.' }
            ],
            7: [
                { english: 'breakfast', chinese: 'æ—©é¤', pos: 'n', example: 'I have eggs for breakfast.' },
                { english: 'restaurant', chinese: 'é¥­é¦†', pos: 'n', example: 'Let us go to a restaurant.' },
                { english: 'menu', chinese: 'èœå•', pos: 'n', example: 'Can I see the menu?' },
                { english: 'delicious', chinese: 'ç¾å‘³çš„', pos: 'adj', example: 'The food is delicious.' },
                { english: 'sweet', chinese: 'ç”œçš„', pos: 'adj', example: 'This apple is sweet.' },
                { english: 'chef', chinese: 'å¨å¸ˆ', pos: 'n', example: 'He is a great chef.' },
                { english: 'drink', chinese: 'å–', pos: 'v', example: 'Drink more water.' },
                { english: 'thirsty', chinese: 'æ¸´çš„', pos: 'adj', example: 'I am thirsty.' }
            ],
            8: [
                { english: 'knowledge', chinese: 'çŸ¥è¯†', pos: 'n', example: 'Reading gives us knowledge.' },
                { english: 'wisdom', chinese: 'æ™ºæ…§', pos: 'n', example: 'The old man has wisdom.' },
                { english: 'memory', chinese: 'è®°å¿†', pos: 'n', example: 'He has a good memory.' },
                { english: 'problem', chinese: 'é—®é¢˜', pos: 'n', example: 'Solve the math problem.' },
                { english: 'courage', chinese: 'å‹‡æ°”', pos: 'n', example: 'You have courage to try.' },
                { english: 'success', chinese: 'æˆåŠŸ', pos: 'n', example: 'Work brings success.' },
                { english: 'dream', chinese: 'æ¢¦æƒ³', pos: 'n', example: 'Follow your dream.' },
                { english: 'expert', chinese: 'ä¸“å®¶', pos: 'n', example: 'He is a computer expert.' }
            ]
        };

        const HEROES = [
            { id: 'alice', name: 'Princess Sky', color: '#4fc3f7', hair: '#fbc02d', power: 'Wind', desc: 'çµåŠ¨å¦‚é£ï¼ŒæŒæ¡è¯æ³•ç§˜å¢ƒã€‚' },
            { id: 'prince', name: 'Valiant Prince', color: '#e53935', hair: '#4e342e', power: 'Fire', desc: 'å‹‡æ•¢å®ˆæŠ¤ï¼Œå‡»ç¢å•è¯éšœç¢ã€‚' },
            { id: 'red', name: 'Little Red', color: '#c62828', hair: '#212121', power: 'Night', desc: 'ç©¿æ¢­æ—é—´ï¼Œå¯»æ‰¾çœŸç†ã€‚' },
            { id: 'ivy', name: 'Princess Ivy', color: '#81c784', hair: '#fff59d', power: 'Earth', desc: 'åšç§¯è–„å‘ï¼Œæ·±æ‰è¯æ ¹ã€‚' }
        ];

        /** ================= COMPONENTS ================= **/

        const PixelSprite = ({ type, variant, action }) => {
            const isHit = action === 'hit';
            const isAttack = action === 'attack';
            const hero = HEROES.find(h => h.id === variant) || HEROES[0];
            
            return (
                <div className={`relative w-32 h-32 flex items-end justify-center transition-all duration-300 ${isAttack ? (type === 'hero' ? 'translate-x-12' : '-translate-x-12') : ''} ${isHit ? 'shake-effect grayscale' : ''}`}>
                    <svg width="100%" height="100%" viewBox="0 0 100 120">
                        <g transform="translate(0, 0)">
                            {/* Chibi Hair Back */}
                            <path d="M20,35 Q10,75 25,100 Q50,115 75,100 Q90,75 80,35" fill={hero.hair} stroke="black" strokeWidth="3" />
                            {/* Body */}
                            <rect x="35" y="75" width="30" height="35" fill={hero.color} stroke="black" strokeWidth="3" />
                            {/* Head */}
                            <circle cx="50" cy="40" r="28" fill="#ffe0b2" stroke="black" strokeWidth="3" />
                            {/* Face */}
                            <circle cx="42" cy="40" r="3" fill="black" />
                            <circle cx="58" cy="40" r="3" fill="black" />
                            <path d="M45,55 Q50,58 55,55" fill="none" stroke="black" strokeWidth="2" />
                            {/* Character Specifics */}
                            {variant === 'alice' && <path d="M35,12 Q50,6 65,12" fill="none" stroke="#1565c0" strokeWidth="5" />}
                            {variant === 'prince' && <path d="M40,12 L45,2 L50,8 L55,2 L60,12 Z" fill="#ffd600" stroke="black" strokeWidth="2" />}
                            {variant === 'red' && <path d="M22,42 Q25,10 50,10 Q75,10 78,42 Q50,25 22,42" fill="#c62828" stroke="black" strokeWidth="2" />}
                        </g>
                    </svg>
                    {isHit && <div className="absolute top-0 text-red-500 font-black text-2xl animate-bounce">-10 HP</div>}
                    {action === 'win' && <div className="absolute top-[-20px] text-yellow-400 text-3xl animate-pulse">ğŸ‘‘</div>}
                </div>
            );
        };

        const MonsterSprite = ({ type, action }) => {
            const isHit = action === 'hit';
            return (
                <div className={`relative w-32 h-32 flex items-end justify-center transition-all duration-300 ${isHit ? 'shake-effect brightness-150' : 'animate-pulse'}`}>
                    <svg width="100%" height="100%" viewBox="0 0 100 100">
                        <path d="M20,80 Q20,30 50,30 Q80,30 80,80 Z" fill={type === 1 ? "#4caf50" : (type === 2 ? "#7e57c2" : "#f44336")} stroke="black" strokeWidth="4" />
                        <circle cx="40" cy="55" r="8" fill="white" stroke="black" strokeWidth="2" />
                        <circle cx="60" cy="55" r="8" fill="white" stroke="black" strokeWidth="2" />
                        <circle cx="42" cy="57" r="3" fill="black" />
                        <circle cx="62" cy="57" r="3" fill="black" />
                    </svg>
                </div>
            );
        };

        const BattleArea = ({ heroId, monsterType, heroAction, monsterAction, isFiring }) => (
            <div className="w-full h-56 pixel-border bg-sky-200 rounded-[40px] flex items-end justify-between px-16 pb-8 relative overflow-hidden mb-8 shadow-inner">
                <div className="absolute inset-0 bg-gradient-to-b from-sky-400 to-green-300 opacity-60"></div>
                <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-black/30 px-6 py-1 rounded-full text-[10px] font-black uppercase tracking-widest text-white border-2 border-white/50">
                    BATTLE FIELD: {monsterType === 1 ? 'SWAMP BLOB' : (monsterType === 2 ? 'MAGIC JELLY' : 'ANCIENT KING')}
                </div>
                
                <PixelSprite type="hero" variant={heroId} action={heroAction} />
                
                {isFiring && (
                    <div className="absolute left-[120px] bottom-[80px] text-4xl fireball-active">ğŸ”¥</div>
                )}
                
                <MonsterSprite type={monsterType} action={monsterAction} />
                
                {monsterAction === 'hit' && <div className="absolute right-32 top-1/2 font-black text-red-600 text-2xl animate-ping uppercase">Wham!</div>}
                {heroAction === 'hit' && <div className="absolute left-32 top-1/2 font-black text-orange-600 text-2xl animate-ping uppercase">Ouch!</div>}
            </div>
        );

        /** ================= GAME LOGIC ================= **/

        const RecallHint = ({ word }) => (
            <div className="absolute inset-0 z-50 flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm">
                <div className="bg-white p-8 pixel-border text-indigo-900 max-w-sm w-full animate-bounce">
                    <div className="text-red-600 font-black text-xs uppercase mb-2 tracking-widest border-b-2 border-red-100 pb-1">Wisdom Scroll (Recall Hint)</div>
                    <div className="text-3xl font-black mb-1 uppercase tracking-tighter">{word.english}</div>
                    <div className="text-xl font-bold mb-4">æ„æ€: {word.chinese} ({word.pos}.)</div>
                    <div className="bg-indigo-50 p-4 border-2 border-indigo-100 rounded-xl italic text-sm">
                        "{word.example}"
                    </div>
                    <div className="mt-6 text-center text-xs font-black text-indigo-300 animate-pulse">ç‚¹å‡»èƒŒæ™¯å…³é—­å¹¶é‡è¯•</div>
                </div>
            </div>
        );

        const StageOne = ({ words, heroId, onComplete }) => {
            const [idx, setIdx] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [showHint, setShowHint] = useState(false);
            const word = words[idx];

            const options = useMemo(() => {
                const choices = [word.chinese];
                const pool = Object.values(RAW_WORDS).flat().filter(w => w.chinese !== word.chinese);
                while(choices.length < 4) {
                    const r = pool[Math.floor(Math.random() * pool.length)].chinese;
                    if(!choices.includes(r)) choices.push(r);
                }
                return choices.sort(() => Math.random() - 0.5);
            }, [idx]);

            const handleAnswer = (ans) => {
                if (ans === word.chinese) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        if (idx + 1 < words.length) setIdx(idx + 1);
                        else onComplete();
                    }, 800);
                } else {
                    setFeedback('wrong');
                    setShowHint(true);
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="h-full flex flex-col items-center">
                    <BattleArea heroId={heroId} monsterType={1} heroAction={feedback==='correct'?'attack':'idle'} monsterAction={feedback==='wrong'?'attack':(feedback==='correct'?'hit':'idle')} isFiring={feedback==='correct'} />
                    <div className="text-7xl font-black text-indigo-900 uppercase tracking-tighter mb-8">{word.english}</div>
                    <div className="game-grid">
                        {options.map((opt, i) => (
                            <button key={i} onClick={() => handleAnswer(opt)} className="pixel-button text-xl h-24">{opt}</button>
                        ))}
                    </div>
                    {showHint && <div className="fixed inset-0" onClick={() => setShowHint(false)}><RecallHint word={word} /></div>}
                </div>
            );
        };

        const StageTwo = ({ words, heroId, onComplete }) => {
            const [idx, setIdx] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [showHint, setShowHint] = useState(false);
            const word = words[idx];

            const display = useMemo(() => {
                const arr = word.english.split('');
                const blankIdx = Math.floor(arr.length / 2);
                const char = arr[blankIdx];
                arr[blankIdx] = '_';
                return { text: arr.join(''), missing: char };
            }, [idx]);

            const handleKey = (l) => {
                if (l === display.missing) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        if (idx + 1 < words.length) setIdx(idx + 1);
                        else onComplete();
                    }, 800);
                } else {
                    setFeedback('wrong');
                    setShowHint(true);
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="h-full flex flex-col items-center">
                    <BattleArea heroId={heroId} monsterType={2} heroAction={feedback==='correct'?'attack':'idle'} monsterAction={feedback==='wrong'?'attack':(feedback==='correct'?'hit':'idle')} isFiring={feedback==='correct'} />
                    <div className="text-3xl font-black text-indigo-500 mb-2 uppercase">{word.chinese} ({word.pos}.)</div>
                    <div className="text-8xl font-black text-indigo-900 tracking-[0.2em] mb-10">{display.text.toUpperCase()}</div>
                    <div className="keyboard-grid">
                        {"abcdefghijklmnopqrstuvwxyz".split('').map(l => (
                            <button key={l} onClick={() => handleKey(l)} className="pixel-border bg-white text-black font-black uppercase text-xs h-10 hover:bg-indigo-100">{l}</button>
                        ))}
                    </div>
                    {showHint && <div className="fixed inset-0" onClick={() => setShowHint(false)}><RecallHint word={word} /></div>}
                </div>
            );
        };

        const StageThree = ({ words, heroId, onComplete }) => {
            const [idx, setIdx] = useState(0);
            const [selected, setSelected] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const word = words[idx];
            
            const correctSeq = word.example.replace(/[.!?]/g, '').split(' ');
            const [pool, setPool] = useState([...correctSeq].sort(() => Math.random() - 0.5));

            const toggle = (w, isPool) => {
                if(isPool) {
                    setSelected([...selected, w]);
                    const nPool = [...pool]; nPool.splice(nPool.indexOf(w), 1);
                    setPool(nPool);
                } else {
                    setPool([...pool, w]);
                    const nSelected = [...selected]; nSelected.splice(nSelected.indexOf(w), 1);
                    setSelected(nSelected);
                }
            };

            const verify = () => {
                if(selected.join(' ') === correctSeq.join(' ')) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        if(idx + 1 < words.length) {
                            setIdx(idx + 1); setSelected([]);
                            const next = words[idx+1].example.replace(/[.!?]/g, '').split(' ');
                            setPool([...next].sort(() => Math.random() - 0.5));
                        } else onComplete();
                    }, 800);
                } else {
                    setFeedback('wrong');
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="h-full flex flex-col items-center">
                    <BattleArea heroId={heroId} monsterType={3} heroAction={feedback==='correct'?'attack':'idle'} monsterAction={feedback==='wrong'?'attack':(feedback==='correct'?'hit':'idle')} isFiring={feedback==='correct'} />
                    <div className="text-2xl font-black text-indigo-400 mb-6 tracking-wide">MAGIC SPELL: {word.chinese}</div>
                    <div className="w-full max-w-2xl min-h-[100px] pixel-border bg-white/20 p-4 flex flex-wrap gap-3 mb-8 rounded-2xl">
                        {selected.map((w, i) => <button key={i} onClick={()=>toggle(w, false)} className="pixel-button bg-indigo-600 text-sm py-2 px-4">{w}</button>)}
                    </div>
                    <div className="flex flex-wrap gap-2 justify-center mb-8">
                        {pool.map((w, i) => <button key={i} onClick={()=>toggle(w, true)} className="pixel-button bg-white text-indigo-900 text-sm py-2 px-4">{w}</button>)}
                    </div>
                    <button onClick={verify} disabled={selected.length === 0} className="pixel-button bg-yellow-400 text-indigo-900 text-2xl px-12 py-4">é‡Šæ”¾å’’è¯­</button>
                </div>
            );
        };

        /** ================= MAIN APP ================= **/
        const App = () => {
            const [state, setState] = useState('LOGIN');
            const [user, setUser] = useState({ id: 'å‹‡è€…', stars: 0 });
            const [hero, setHero] = useState(null);
            const [world, setWorld] = useState(null);
            const [stage, setStage] = useState(1);

            if (state === 'LOGIN') return (
                <div className="h-screen flex flex-col items-center justify-center bg-indigo-900 p-8">
                    <div className="text-9xl mb-12 floating">ğŸ“–</div>
                    <div className="bg-white p-12 pixel-border flex flex-col gap-8 max-w-sm w-full">
                        <h1 className="text-4xl font-black text-center text-indigo-900 uppercase tracking-tighter">Word Kingdom</h1>
                        <input id="uname" className="border-4 border-black p-4 text-xl font-bold text-indigo-900 outline-none" placeholder="è¾“å…¥ä½ çš„ ID" defaultValue="Player1" />
                        <button onClick={() => { setUser({...user, id: document.getElementById('uname').value}); setState('HERO'); }} className="pixel-button bg-yellow-400 text-indigo-900 text-2xl font-black">è¿›å…¥ç‹å›½</button>
                    </div>
                </div>
            );

            if (state === 'HERO') return (
                <div className="h-screen bg-indigo-950 p-8 flex flex-col items-center justify-center">
                    <h2 className="text-4xl font-black mb-16 tracking-widest">é€‰æ‹©ä½ çš„å®ˆæŠ¤å‹‡è€…</h2>
                    <div className="flex gap-8 overflow-x-auto w-full max-w-6xl px-4 pb-12 no-scrollbar">
                        {HEROES.map(h => (
                            <div key={h.id} onClick={() => { setHero(h); setState('MAP'); }} className="min-w-[280px] bg-white p-10 pixel-border text-indigo-900 cursor-pointer hover:bg-yellow-50 hover:-translate-y-4 transition-all flex flex-col items-center group">
                                <PixelSprite variant={h.id} action="idle" />
                                <div className="mt-8 font-black text-3xl">{h.name}</div>
                                <div className="mt-2 text-sm font-black text-indigo-400 uppercase tracking-widest">{h.power} Power</div>
                                <div className="mt-6 text-sm text-center font-medium opacity-70 leading-relaxed">{h.desc}</div>
                                <div className="mt-8 pixel-button bg-indigo-600 text-white w-full text-center py-2 group-hover:bg-indigo-700 transition-colors">é€‰æ‹©</div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (state === 'MAP') return (
                <div className="h-screen bg-sky-100 p-8 overflow-y-auto no-scrollbar">
                    <div className="max-w-4xl mx-auto flex flex-col gap-10">
                        <header className="flex justify-between items-center bg-white p-6 pixel-border">
                            <h1 className="text-4xl font-black text-indigo-900 uppercase tracking-widest">Adventure Map</h1>
                            <div className="flex items-center gap-4">
                                <span className="bg-indigo-100 px-4 py-2 rounded-full font-black text-indigo-900">å‹‡è€…: {user.id}</span>
                                <span className="bg-yellow-400 px-4 py-2 rounded-full font-black text-indigo-900">â­ {user.stars}</span>
                            </div>
                        </header>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                            {Object.entries(RAW_WORDS).map(([id, words]) => (
                                <div key={id} className="bg-white p-10 pixel-border group relative overflow-hidden flex flex-col justify-between min-h-[220px]">
                                    <div className="flex justify-between items-start">
                                        <div className="text-3xl font-black text-indigo-900 uppercase">Unit {id}</div>
                                        <div className="text-xs font-black text-indigo-300">8æ ¸å¿ƒè¯æ±‡</div>
                                    </div>
                                    <div className="flex gap-6 mt-8">
                                        {[1, 2, 3].map(s => (
                                            <button key={s} onClick={() => { setWorld(id); setStage(1); setState('GAME'); }} className="w-16 h-16 bg-white border-4 border-black font-black text-2xl hover:bg-indigo-600 hover:text-white flex items-center justify-center shadow-[4px_4px_0_black] active:translate-x-1 active:translate-y-1 active:shadow-none">
                                                {s}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (state === 'GAME') {
                const words = RAW_WORDS[world] || RAW_WORDS[1];
                return (
                    <div className="h-screen bg-sky-50 flex flex-col">
                        <div className="h-20 flex justify-between items-center px-12 border-b-4 border-black bg-white shadow-md">
                            <button onClick={() => setState('MAP')} className="text-red-500 font-black text-xl hover:scale-110 transition-transform">æ’¤é€€</button>
                            <div className="flex flex-col items-center">
                                <div className="text-[10px] font-black uppercase text-indigo-300">Unit {world} æŒ‘æˆ˜ä¸­</div>
                                <div className="text-2xl font-black text-indigo-900 uppercase tracking-widest">é˜¶æ®µ {stage}/3</div>
                            </div>
                            <div className="w-10"></div>
                        </div>
                        <div className="flex-1 p-10">
                            {stage === 1 && <StageOne words={words} heroId={hero.id} onComplete={() => setStage(2)} />}
                            {stage === 2 && <StageTwo words={words} heroId={hero.id} onComplete={() => setStage(3)} />}
                            {stage === 3 && <StageThree words={words} heroId={hero.id} onComplete={() => { setUser({...user, stars: user.stars+1}); setState('WIN'); }} />}
                        </div>
                    </div>
                );
            }

            if (state === 'WIN') return (
                <div className="h-screen flex flex-col items-center justify-center bg-emerald-600 text-white p-8">
                    <div className="text-9xl floating mb-12">ğŸ†</div>
                    <PixelSprite variant={hero.id} action="win" />
                    <h2 className="text-7xl font-black mt-8 mb-6 uppercase tracking-tighter">è¯æ³•ä¹‹æˆ˜å¤§èƒœï¼</h2>
                    <p className="text-3xl font-bold opacity-80 mb-16">ä½ çš„æ™ºæ…§ç‚¹äº®äº†è¿™ç‰‡è¿·é›¾é¢†åœ°ã€‚</p>
                    <button onClick={() => setState('MAP')} className="pixel-button bg-yellow-400 text-indigo-900 px-20 py-8 text-3xl font-black">è¿”å›ç‹åŸ</button>
                </div>
            );

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        window.dispatchEvent(new Event('game-ready'));
    </script>

    <script>
        // Progress Logic
        const progressBar = document.getElementById('progress-bar');
        let p = 0;
        const itv = setInterval(() => {
            if(p < 95) { p += Math.random()*15; progressBar.style.width = p + '%'; }
        }, 200);
        window.addEventListener('game-ready', () => {
            clearInterval(itv);
            progressBar.style.width = '100%';
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').remove(), 500);
            }, 500);
        });
    </script>
</body>
</html>
